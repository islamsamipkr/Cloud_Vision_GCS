from google.cloud import vision,storage

vision_client=vision.ImageAnnotatorClient()
storage_client=storage.Client()

def detect_face(data, context):
    """Triggered by a change to a Cloud Storage bucket.
    Args:
         event (dict): Event payload.
         context (google.cloud.functions.Context): Metadata for the event.
    """
    file_data = data
    file_name=file_data["name"]
    bucket_name=file_data["bucket"]



    print(f"Processing file: {file_name}.")
    print(f"Bucket : {bucket_name}.")

    blob=storage_client.bucket(bucket_name).get_blob(file_name)
    blob_url=f"gs://{bucket_name}/{file_name}"
    blob_source=vision.Image(source=vision.ImageSource(gcs_image_url=blob_url))

    faces=vision_client.face_detection(image=blob_source,max_results=4).face_annotations
    print(faces)
